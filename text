#!/system/bin/sh

# ============================================
# RESTAURACIÓN COMPLETA REDMI 9A
# Restaura todas las apps y configuraciones
# ============================================

echo "Iniciando restauración completa..."

# -------------------------------------------------
# 1. RESTAURAR TODAS LAS APPS ELIMINADAS
# -------------------------------------------------
echo "Restaurando aplicaciones..."

# Apps de Xiaomi
cmd package install-existing com.miui.videoplayer
cmd package install-existing com.miui.player
cmd package install-existing com.miui.compass
cmd package install-existing com.xiaomi.mipicks
cmd package install-existing com.xiaomi.midrop
cmd package install-existing com.miui.weather2
cmd package install-existing com.miui.calculator
cmd package install-existing com.miui.screenrecorder
cmd package install-existing com.android.browser
cmd package install-existing com.miui.fm
cmd package install-existing com.miui.touchassistant
cmd package install-existing com.miui.misound
cmd package install-existing com.miui.huanji
cmd package install-existing com.miui.voiceassist
cmd package install-existing com.miui.virtualsim
cmd package install-existing com.miui.yellowpage
cmd package install-existing com.miui.notes
cmd package install-existing com.miui.backup
cmd package install-existing com.xiaomi.gamecenter
cmd package install-existing com.xiaomi.joyose
cmd package install-existing com.xiaomi.payment

# Apps de Google
cmd package install-existing com.google.android.youtube
cmd package install-existing com.google.android.apps.youtube.music
cmd package install-existing com.google.android.apps.photos
cmd package install-existing com.google.android.apps.tachyon
cmd package install-existing com.google.android.videos
cmd package install-existing com.google.android.music
cmd package install-existing com.android.chrome
cmd package install-existing com.google.android.apps.maps
cmd package install-existing com.google.android.gm
cmd package install-existing com.google.android.tts
cmd package install-existing com.google.android.apps.docs
cmd package install-existing com.google.android.apps.drive
cmd package install-existing com.google.android.apps.messaging
cmd package install-existing com.android.hotwordenrollment.okgoogle
cmd package install-existing com.android.hotwordenrollment.google

# Apps de sistema
cmd package install-existing com.android.email
cmd package install-existing com.android.calendar

# Apps de terceros
cmd package install-existing com.facebook.appmanager
cmd package install-existing com.facebook.services
cmd package install-existing com.facebook.system
cmd package install-existing com.facebook.katana
cmd package install-existing com.netflix.mediaclient
cmd package install-existing com.netflix.partner.activation
cmd package install-existing com.amazon.mShop.android.shopping
cmd package install-existing com.microsoft.office.excel
cmd package install-existing com.microsoft.office.word
cmd package install-existing com.microsoft.office.powerpoint
cmd package install-existing com.spotify.music
cmd package install-existing com.twitter.android
cmd package install-existing com.instagram.android
cmd package install-existing com.whatsapp
cmd package install-existing com.tencent.mm
cmd package install-existing com.alibaba.aliexpresshd
cmd package install-existing com.ebay.mobile

# -------------------------------------------------
# 2. RESTAURAR CONFIGURACIONES DEL SISTEMA
# -------------------------------------------------
echo "Restaurando configuraciones..."

# ANIMACIONES (VALORES NORMALES)
settings put global window_animation_scale 1.0
settings put global transition_animation_scale 1.0
settings put global animator_duration_scale 1.0

# MEMORIA (VALORES POR DEFECTO)
settings put global background_process_limit 20
settings put global app_max_cached_processes 32
settings put global memory_optimization_level 0
settings put global memory_pressure_level 0

# REACTIVAR MIUI OPTIMIZATION
settings put global miui_optimization 1

# PRIVACIDAD Y UBICACIÓN
settings put secure location_mode 3
settings put global wifi_scan_always_enabled 1
settings put global ble_scan_always_enabled 1
settings put global mobile_data_always_on 1
settings put global network_recommendations_enabled 1

# REDES
settings put global tether_dun_required 1
settings put global captive_portal_mode 0
settings put private global network_avoid_bad_wifi 0

# VERIFICACIONES Y LOGS
settings put global package_verifier_enable 1
settings put global upload_log_pref 1
settings put global send_action_app_error 1
settings put global development_settings_enabled 1
settings put global bugreport_in_power_menu 1

# -------------------------------------------------
# 3. RESTAURAR CONFIGURACIÓN DE BATERÍA
# -------------------------------------------------
echo "Restaurando configuración de batería..."
settings put global low_power 0
settings put global low_power_sticky 0
settings put global adaptive_battery_management_enabled 0
settings put global app_standby_enabled 0
settings put global bg_restriction_level 0
settings put global app_restriction_enabled 0
settings put global auto_sync 1

# DOZE MODE NORMAL
settings put global device_idle_constants \
light_after_inactive_to=30000,\
light_pre_idle_to=60000,\
light_max_idle_to=21600000,\
light_idle_to=3600000,\
light_idle_factor=2.0,\
min_light_maintenance_time=60000,\
min_deep_maintenance_time=300000

settings put global sync_max_retry_delay_in_seconds 3600

# -------------------------------------------------
# 4. RESTAURAR RENDIMIENTO
# -------------------------------------------------
echo "Restaurando configuración de rendimiento..."
settings put global game_driver_opt_in 0
settings put global gpu_debug_layers 1
settings put global thermal_limit 1.0
settings put global thermal_control_enabled 0
settings put system touch_sensitivity 0
settings put system touch_responsiveness 0
settings put global storage_benchmark 0
settings put global fsync_enabled 1

# -------------------------------------------------
# 5. RESTAURAR INTERFAZ Y SONIDO
# -------------------------------------------------
cmd uimode night no
settings put system notification_snooze_options 3,4,8
settings put system show_notification_channel_warnings 1
settings put system accelerometer_rotation 0
settings put system sound_effects_enabled 1
settings put system lockscreen_sounds_enabled 1
settings put system charging_sounds_enabled 1
settings put system haptic_feedback_enabled 1
settings put system notification_light_pulse 1

# -------------------------------------------------
# 6. RESTAURAR SEGURIDAD
# -------------------------------------------------
settings put global appops_auto_revoke_mode 0
settings put global auto_revoke_unused_threshold 15552000000
settings put global backup_auto_restore 1
settings put secure backup_enabled 1
settings put global adb_enabled 1

# -------------------------------------------------
# 7. RESTAURAR ALMACENAMIENTO
# -------------------------------------------------
settings put global sys_free_storage_log_interval 86400000
settings put global storage_cache_percentage 10
settings put global fstrim_mandatory_interval 604800000
settings put global sqlite_compatibility_wal_flags 0

# -------------------------------------------------
# 8. RESTAURAR CONFIGURACIÓN KERNEL
# -------------------------------------------------
echo "Restaurando configuración kernel..."
echo "interactive" > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
echo "interactive" > /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor
echo "interactive" > /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
echo "interactive" > /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor

echo 80000 > /sys/devices/system/cpu/cpufreq/interactive/min_sample_time
echo 20000 > /sys/devices/system/cpu/cpufreq/interactive/timer_rate
echo 99 > /sys/devices/system/cpu/cpufreq/interactive/go_hispeed_load
echo 998400 > /sys/devices/system/cpu/cpufreq/interactive/hispeed_freq

echo 60 > /proc/sys/vm/swappiness
echo 100 > /proc/sys/vm/vfs_cache_pressure
echo 20 > /proc/sys/vm/dirty_ratio
echo 10 > /proc/sys/vm/dirty_background_ratio

# -------------------------------------------------
# 9. REINICIAR SERVICIOS
# -------------------------------------------------
echo "Reiniciando servicios..."
start thermal-engine
start miuibooster
start mcd_service
start traced
start traced_probes

# -------------------------------------------------
# 10. LIMPIAR CACHÉ DE SISTEMA
# -------------------------------------------------
echo "Limpiando caché del sistema..."
pm clear com.android.systemui
pm clear com.android.launcher
pm clear com.miui.home
pm clear android
pm clear com.google.android.gms

# -------------------------------------------------
# 11. RESET DE CONFIGURACIONES DE APPS
# -------------------------------------------------
echo "Reseteando configuraciones de apps..."
settings delete global policy_control
settings delete system screen_brightness_mode
settings delete secure sysui_qs_tiles
settings delete system status_bar_clock
settings delete system status_bar_show_battery_percent

# -------------------------------------------------
# FINALIZACIÓN
# -------------------------------------------------
echo " "
echo "========================================"
echo "RESTAURACIÓN COMPLETA FINALIZADA"
echo "========================================"
echo " "
echo "ACCIONES REQUERIDAS:"
echo "1. REINICIA el dispositivo ahora"
echo "2. Después del reinicio, ve a:"
echo "   - Ajustes > Opciones adicionales"
echo "   - Opciones de desarrollador"
echo "   - Restablecer todas las opciones"
echo "3. Ve a: Ajustes > Batería"
echo "   - Desactiva 'Ahorro de batería'"
echo "4. Configura las apps de nuevo"
echo " "
echo "NOTA: Algunas apps pueden requerir:"
echo "- Actualizaciones desde Play Store"
echo "- Reconfiguración manual"
echo "- Permisos adicionales"
echo " "
echo "El dispositivo volverá a estado original"
echo " "
